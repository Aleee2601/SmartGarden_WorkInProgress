<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SmartGarden_WorkInProgress.ViewModels"
             xmlns:models="clr-namespace:SmartGarden_WorkInProgress.Models"
             xmlns:controls="clr-namespace:SmartGarden_WorkInProgress.Controls"
             x:Class="SmartGarden_WorkInProgress.Views.DashboardPage"
             x:DataType="viewmodels:DashboardViewModel"
             BackgroundColor="{StaticResource ColorSurface}">

    <Grid>
        <!-- Main Content -->
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="24">
                <!-- Header -->
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                    <!-- User Avatar -->
                    <BoxView Grid.Column="0"
                             WidthRequest="36"
                             HeightRequest="36"
                             CornerRadius="18"
                             BackgroundColor="{StaticResource ColorPrimary}" />

                    <!-- User Name -->
                    <Label Grid.Column="1"
                           Text="{Binding UserName}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource ColorText}"
                           VerticalOptions="Center" />

                    <!-- Settings Button -->
                    <Frame Grid.Column="2"
                           Padding="8"
                           CornerRadius="20"
                           HasShadow="False"
                           BackgroundColor="{StaticResource ColorSurfaceAlt}"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ShowMenuCommand}" />
                        </Frame.GestureRecognizers>
                        <Label Text="settings"
                               FontFamily="MaterialSymbols"
                               FontSize="20"
                               TextColor="{StaticResource ColorText}"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />
                    </Frame>
                </Grid>

                <!-- Title with Superscript -->
                <HorizontalStackLayout Spacing="2">
                    <Label Text="My plants"
                           Style="{StaticResource TitleStyle}" />
                    <Label Text="ยน"
                           FontSize="14"
                           TextColor="{StaticResource ColorSubtle}"
                           VerticalOptions="Start"
                           Margin="0,4,0,0" />
                </HorizontalStackLayout>

                <!-- Room Filters -->
                <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                    <HorizontalStackLayout Spacing="8" BindableLayout.ItemsSource="{Binding Rooms}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="models:RoomFilter">
                                <Frame Padding="16,8"
                                       CornerRadius="20"
                                       HasShadow="False"
                                       BorderColor="Transparent">
                                    <Frame.BackgroundColor>
                                        <MultiBinding Converter="{StaticResource RoomFilterBackgroundConverter}">
                                            <Binding Path="IsSelected" />
                                        </MultiBinding>
                                    </Frame.BackgroundColor>
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:DashboardViewModel}}, Path=SelectRoomCommand}"
                                                              CommandParameter="{Binding .}" />
                                    </Frame.GestureRecognizers>
                                    <HorizontalStackLayout Spacing="8">
                                        <Label VerticalOptions="Center">
                                            <Label.Text>
                                                <MultiBinding StringFormat="{}{0}">
                                                    <Binding Path="Name" />
                                                </MultiBinding>
                                            </Label.Text>
                                            <Label.TextColor>
                                                <MultiBinding Converter="{StaticResource RoomFilterTextConverter}">
                                                    <Binding Path="IsSelected" />
                                                </MultiBinding>
                                            </Label.TextColor>
                                        </Label>
                                        <Frame IsVisible="{Binding Count, Converter={StaticResource CountToVisibilityConverter}}"
                                               Padding="6,2"
                                               CornerRadius="8"
                                               HasShadow="False"
                                               BackgroundColor="{StaticResource ColorPrimary}"
                                               BorderColor="Transparent">
                                            <Label Text="{Binding Count}"
                                                   FontSize="10"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   VerticalOptions="Center" />
                                        </Frame>
                                    </HorizontalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </HorizontalStackLayout>
                </ScrollView>

                <!-- Indoor/Outdoor Badges -->
                <HorizontalStackLayout Spacing="8">
                    <controls:Badge Text="INDOOR" Variant="Success" />
                    <controls:Badge Text="OUTDOOR" Variant="Neutral" />
                </HorizontalStackLayout>

                <!-- Plant Cards Grid -->
                <FlexLayout BindableLayout.ItemsSource="{Binding Plants}"
                            Wrap="Wrap"
                            JustifyContent="SpaceBetween"
                            AlignItems="Start">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:Plant">
                            <Frame Padding="20"
                                   CornerRadius="24"
                                   HasShadow="True"
                                   BorderColor="Transparent"
                                   WidthRequest="170"
                                   HeightRequest="220"
                                   Margin="0,0,0,16"
                                   Background="{StaticResource GradientGreen}">
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:DashboardViewModel}}, Path=PlantTappedCommand}"
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>
                                <Grid RowDefinitions="Auto,*,Auto,Auto,Auto" RowSpacing="8">
                                    <!-- Check Icon -->
                                    <Label Grid.Row="0"
                                           Text="check_circle"
                                           FontFamily="MaterialSymbols"
                                           FontSize="20"
                                           TextColor="White"
                                           IsVisible="{Binding IsSelected}"
                                           HorizontalOptions="Start" />

                                    <!-- Plant Image Placeholder -->
                                    <BoxView Grid.Row="1"
                                             WidthRequest="80"
                                             HeightRequest="80"
                                             CornerRadius="40"
                                             BackgroundColor="#FFFFFF40"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center" />

                                    <!-- Plant Nickname -->
                                    <Label Grid.Row="2"
                                           Text="{Binding Nickname}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="White"
                                           HorizontalOptions="Center" />

                                    <!-- Species -->
                                    <Label Grid.Row="3"
                                           Text="{Binding Species}"
                                           FontSize="12"
                                           TextColor="White"
                                           Opacity="0.8"
                                           HorizontalOptions="Center" />

                                    <!-- Badge -->
                                    <controls:Badge Grid.Row="4"
                                                    Text="{Binding IsIndoor, Converter={StaticResource IndoorOutdoorConverter}}"
                                                    Variant="Success"
                                                    HorizontalOptions="Center" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>

                <!-- Tips & Tricks Section -->
                <Label Text="Tips &amp; Tricks"
                       Style="{StaticResource H2Style}"
                       Margin="0,8,0,0" />

                <!-- Tips Grid -->
                <FlexLayout BindableLayout.ItemsSource="{Binding Tips}"
                            Wrap="Wrap"
                            JustifyContent="SpaceBetween"
                            AlignItems="Start">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:TipCard">
                            <controls:TipCardView Icon="{Binding Icon}"
                                                  Title="{Binding Title}"
                                                  Text="{Binding Text}"
                                                  Emphasis="{Binding Emphasis}"
                                                  WidthRequest="170"
                                                  Margin="0,0,0,16" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Menu Overlay -->
        <Grid IsVisible="{Binding IsMenuOpen}"
              BackgroundColor="#80000000"
              InputTransparent="False">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding ShowMenuCommand}" />
            </Grid.GestureRecognizers>

            <!-- Menu Sheet -->
            <Frame VerticalOptions="Start"
                   HorizontalOptions="End"
                   Margin="20,80,20,0"
                   Padding="0"
                   CornerRadius="20"
                   BackgroundColor="{StaticResource ColorSurface}"
                   HasShadow="True"
                   WidthRequest="250"
                   InputTransparent="False">
                <VerticalStackLayout Spacing="0">
                    <Frame Padding="16"
                           CornerRadius="0"
                           HasShadow="False"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding MenuItemCommand}" CommandParameter="Profile" />
                        </Frame.GestureRecognizers>
                        <Label Text="Profile"
                               FontSize="16"
                               TextColor="{StaticResource ColorText}" />
                    </Frame>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource ColorSurfaceAlt}" />

                    <Frame Padding="16"
                           CornerRadius="0"
                           HasShadow="False"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding MenuItemCommand}" CommandParameter="Add a new plant" />
                        </Frame.GestureRecognizers>
                        <Label Text="Add a new plant"
                               FontSize="16"
                               TextColor="{StaticResource ColorText}" />
                    </Frame>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource ColorSurfaceAlt}" />

                    <Frame Padding="16"
                           CornerRadius="0"
                           HasShadow="False"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding MenuItemCommand}" CommandParameter="Calibrate sensors" />
                        </Frame.GestureRecognizers>
                        <Label Text="Calibrate sensors"
                               FontSize="16"
                               TextColor="{StaticResource ColorText}" />
                    </Frame>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource ColorSurfaceAlt}" />

                    <Frame Padding="16"
                           CornerRadius="0"
                           HasShadow="False"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding MenuItemCommand}" CommandParameter="Help" />
                        </Frame.GestureRecognizers>
                        <Label Text="Help"
                               FontSize="16"
                               TextColor="{StaticResource ColorText}" />
                    </Frame>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource ColorSurfaceAlt}" />

                    <Frame Padding="16"
                           CornerRadius="0"
                           HasShadow="False"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding MenuItemCommand}" CommandParameter="About Us" />
                        </Frame.GestureRecognizers>
                        <Label Text="About Us"
                               FontSize="16"
                               TextColor="{StaticResource ColorText}" />
                    </Frame>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>

</ContentPage>
